name: AI Triage

on:
  workflow_dispatch:
    inputs:
      failing_run_id:
        description: "Failing CI run ID (from dispatcher)"
        required: true
        type: string
      failing_run_url:
        description: "Failing CI run URL (optional)"
        required: false
        type: string

permissions:
  contents: read
  pull-requests: write
  issues: write
  actions: read
  id-token: write

concurrency:
  group: ai-triage-${{ github.repository }}
  cancel-in-progress: false

jobs:
  call:
    uses: mizunotaro/ai-playbook/.github/workflows/reuse-ai-triage.yml@fd2898a18cb21cf32aca87b5c2084fa2218968c0
    with:
      # Align to your OpenCode GitHub install selection:
      # Provider: Z.AI Coding Plan, Model: GLM-4.7
      model: "zai-coding-plan/glm-4.7"
      failing_run_id: ${{ inputs.failing_run_id }}
      failing_run_url: ${{ inputs.failing_run_url }}
    secrets:
      ZAI_API_KEY: ${{ secrets.ZAI_API_KEY }}